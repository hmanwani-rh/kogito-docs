<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title> Displaying workflow runtime data in Serverless Dashboards :: Kogito Serverless Workflow Guides</title>
    <meta name="description" content="Displaying workflow runtime data in Serverless Dashboards">
    <meta name="keywords" content="kogito, workflow, quarkus, serverless, dashboards, monitoring">
    <meta name="generator" content="Antora 3.0.1">
    <link rel="stylesheet" href="../../../_/css/site.css">
<link rel="stylesheet" href="../../../_/css/search.css">
<link rel="stylesheet" href="../../../_/css/menu.css">
<link rel="stylesheet" href="../../../_/css/tabs.css">
<link rel="stylesheet" href="../../../_/css/navbar.css">
<link rel="stylesheet" href="../../../_/css/custom.css">
<link rel="stylesheet" href="../../../_/css/home.css"><script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
    <nav class="navbar">
        <div class="navbar-brand">
            <div class="navbar-item">
                <a href="../../..">
                    <img src="../../../_/img/kogitoLogo_default_64px.png" height="50px" alt="Kogito logo"/>
                </a>
                <a class="navbar-item" href="../../..">
                    Kogito Serverless Workflow Guides
                </a>
            </div>
                <div class="navbar-item search hide-for-print">
                    <div id="search-field" class="field">
                        <input id="search-input" type="text" placeholder="Search docs">
                    </div>
                </div>
            <button class="navbar-burger" data-target="topbar-nav">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
        <div id="topbar-nav" class="navbar-menu">
            <div class="navbar-end">
                <div class="navbar-item">
                    <a class="navbar-item small-item" href="https://github.com/kiegroup"
                       target="_blank" title="Follow KIE on GitHub">
                        <div class="github-icon"></div>
                    </a>
                </div>
            </div>
        </div>
    </nav>
</header>
<div class="body">
<div class="nav-container" data-component="serverlessworkflow" data-version="main">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Kogito Serverless Workflow Guides</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Getting Started</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../getting-started/create-your-first-workflow-service.html">Creating your first Serverless Workflow service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../getting-started/cncf-serverless-workflow-specification-support.html">CNCF Serverless Workflow specification</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Core</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../core/understanding-jq-expressions.html">jq expressions in Serverless Workflow</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../core/understanding-workflow-error-handling.html">Error handling in Serverless Workflow</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../core/custom-functions-support.html">Custom functions for your Serverless Workflow service</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Tooling</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../tooling/serverless-workflow-editor/swf-editor-overview.html">Serverless Workflow editor</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../tooling/serverless-workflow-editor/swf-editor-chrome-extension.html">Chrome GitHub extension for Serverless Workflow editor</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../tooling/serverless-workflow-editor/swf-editor-vscode-extension.html">VS Code extension for Serverless Workflow editor</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../tooling/quarkus-dev-ui-extension/quarkus-dev-ui-overview.html">Kogito Serverless Workflow Tools extension in Quarkus Dev UI</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../tooling/quarkus-dev-ui-extension/quarkus-dev-ui-workflow-instances-page.html">Workflow Instances in Kogito Serverless Workflow Tools extension</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../tooling/quarkus-dev-ui-extension/quarkus-dev-ui-workflow-definition-page.html">Workflow Definitions in Kogito Serverless Workflow Tools extension</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../tooling/kn-plugin-workflow-overview.html">Serverless Workflow plug-in for Knative CLI</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Service Orchestration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../service-orchestration/orchestration-of-openapi-based-services.html">Orchestrating the OpenAPI services</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../service-orchestration/orchestration-of-grpc-services.html">Orchestration of gRPC based services</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Security</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/authention-support-for-openapi-services.html">Authentication for OpenAPI services in Serverless Workflow</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/orchestrating-third-party-services-with-oauth2.html">Orchestrating third party services with OAuth2 authentication</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Testing and Troubleshooting</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../testing-and-troubleshooting/mocking-opnapi-services-with-wiremock.html">Mocking OpenAPI services using WireMock</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../testing-and-troubleshooting/basic-integration-tests-with-restassured.html">Testing your Serverless Workflow application using REST Assured</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Cloud</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cloud/build-workflow-image-with-quarkus-cli.html">Building Serverless Workflow Images using Quarkus CLI</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cloud/deploying-on-minikube.html">Deploying your Serverless Workflow application on Minikube</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Integrations</span>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="serverless-dashboard-with-runtime-data.html">Displaying workflow runtime data in serverless dashboards</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Kogito Serverless Workflow Guides</span>
    <span class="version">main</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Kogito Serverless Workflow Guides</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">main</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Kogito Serverless Workflow Guides</a></li>
    <li>Integrations</li>
    <li><a href="serverless-dashboard-with-runtime-data.html">Displaying workflow runtime data in serverless dashboards</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/kiegroup/kogito-docs/edit/main/serverlessworkflow/modules/ROOT/pages/integrations/serverless-dashboard-with-runtime-data.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page"> Displaying workflow runtime data in Serverless Dashboards</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>To build dashboards we need data and it can be easily acquired from Kogito Serverless Workflow using any of the following approaches:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Enabling <strong>Metrics</strong></p>
</li>
<li>
<p>Integrating with <strong>Data Index</strong> to consume data using its REST API</p>
</li>
<li>
<p>Using custom mechanisms (such as <code>ProcessInstanceListener</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In this document we will explore creating dashboards for metrics and for Data Index GraphQL REST API.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_serverless_dashboards_with_dashbuilder"><a class="anchor" href="#_serverless_dashboards_with_dashbuilder"></a>Serverless Dashboards with Dashbuilder</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Serverless Dashboards are visualizations that run entirely on the client side. We will use <a href="https://www.dashbuilder.org">Dashbuilder</a> to create Dashboards: it consumes data from any JSON source and the dashboard is defined in YAML format.</p>
</div>
<div class="paragraph">
<p>To use Dashbuilder you need to download, uncompress the <code>dashbuilder-client</code> NPM package and edit the file <strong>setup.js</strong> to link your YAML files. For further information please check <a href="https://www.dashbuilder.org/docs/#_client_only">Dashbuilder documentation</a>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/integrations/dashbuilder-sample-report.png" alt="dashbuilder sample report">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_metrics_for_building_dashboards"><a class="anchor" href="#_using_metrics_for_building_dashboards"></a>Using Metrics for building Dashboards</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To enable metrics for your Serverless Workflow application add the <code>org.kie.kogito:kogito-addons-quarkus-monitoring-prometheus</code> dependency to your apps&#8217;s classpath and the metrics will be available at <code>/q/metrics</code> path.</p>
</div>
<div class="listingblock">
<div class="title">Metrics Dependency to be added to <code>pom.xml</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">    &lt;dependency&gt;
      &lt;groupId&gt;org.kie.kogito&lt;/groupId&gt;
      &lt;artifactId&gt;kogito-addons-quarkus-monitoring-prometheus&lt;/artifactId&gt;
    &lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Dashbuilder can consume data directly from metrics endpoints. Using a <a href="https://docs.jsonata.org/overview.html">JSONAta expression</a> to format some metrics we can simply show metrics in a table using the following YML:</p>
</div>
<div class="listingblock">
<div class="title">Show metrics in a table</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">datasets:
  - uuid: swf_metrics
    url: http://localhost:8080/q/metrics
    expression: &gt;-
        $map($, function($l) {
                [
                    $l[0],
                    $contains($l[1], "process_id") ?
                                            $replace($match($l[1], /process_id=".*?"/).match,
                                            "process_id",
                                            "workflow") :
                                            $l[1],
                    $l[2] = "NaN" ? -1 : $l[2]
                ]
            }
        )
pages:
    - components:
        - settings:
            lookup:
               uuid: swf_metrics</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/integrations/dashbuilder-metrics-table.png" alt="dashbuilder metrics table">
</div>
<div class="title">Figure 1. Metrics in a table</div>
</div>
<div class="paragraph">
<p>To extract a specific information from the Workflow, you can use specific Kogito metrics, and when displaying the metric we filter the data to only include it. Metrics related to Serverless Workflow:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>kogito_process_instance_completed_total</strong>: Completed Workflows</p>
</li>
<li>
<p><strong>kogito_process_instance_started_total</strong>: Started Workflows</p>
</li>
<li>
<p><strong>kogito_process_instance_running_total</strong>: Running Workflows</p>
</li>
<li>
<p><strong>kogito_process_instance_duration_seconds_sum</strong>: Workflows Total Duration</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Dashbuilder <strong>metrics</strong> and <strong>bar chart</strong> components are useful to display these metrics. After filtering specific metrics we can put the information in bar charts as you can see the YML below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">datasets:
  - uuid: metrics
    url: http://localhost:8080/q/metrics
    expression: &gt;-
        $map($, function($l) {
                [
                    $l[0],
                    $contains($l[1], "process_id") ?
                                            $replace($match($l[1], /process_id=".*?"/).match,
                                            "process_id",
                                            "workflow") :
                                            $l[1],
                    $l[2] = "NaN" ? -1 : $l[2]
                ]
            }
        )
    columns:
      - id: metric
        type: label
      - id: labels
        type: label
      - id: value
        type: number
pages:
  - rows:
      - columns:
          - span: "6"
            components:
              - html: &gt;-
                  &lt;p style="font-size: large"&gt;Started &lt;/p&gt;
              - settings:
                  type: BARCHART
                  chart:
                    resizable: 'true'
                    width: '2000'
                  lookup:
                    uuid: metrics
                    sort:
                      - column: value
                        sortOrder: DESCENDING
                    filter:
                      - column: metric
                        function: EQUALS_TO
                        args:
                          - "kogito_process_instance_started_total"
                    group:
                      - columnGroup:
                          source: labels
                        groupFunctions:
                          - source: labels
                          - source: value
          - span: "6"
            components:
              - html: &gt;-
                  &lt;p style="font-size: large"&gt;Running &lt;/p&gt;
              - settings:
                  type: BARCHART
                  chart:
                    resizable: 'true'
                    width: '2000'
                  lookup:
                    uuid: metrics
                    sort:
                      - column: value
                        sortOrder: DESCENDING
                    filter:
                      - column: metric
                        function: EQUALS_TO
                        args:
                          - "kogito_process_instance_running_total"
                    group:
                      - columnGroup:
                          source: labels
                        groupFunctions:
                          - source: labels
                          - source: value
      - columns:
          - span: "6"
            components:
              - html: &gt;-
                  &lt;p style="font-size: large"&gt;Completed &lt;/p&gt;
              - settings:
                  type: BARCHART
                  chart:
                    resizable: 'true'
                    width: '2000'
                  dataSetLookup:
                    uuid: metrics
                    sort:
                      - column: value
                        sortOrder: DESCENDING
                    filter:
                      - column: metric
                        function: EQUALS_TO
                        args:
                          - "kogito_process_instance_completed_total"
                    group:
                      - columnGroup:
                          source: labels
                        groupFunctions:
                          - source: labels
                          - source: value
          - span: "6"
            components:
              - html: &gt;-
                  &lt;p style="font-size: large"&gt;Total Duration &lt;/p&gt;
              - settings:
                  type: BARCHART
                  chart:
                    resizable: 'true'
                    width: '2000'
                  lookup:
                    uuid: metrics
                    sort:
                      - column: value
                        sortOrder: DESCENDING
                    filter:
                      - column: metric
                        function: EQUALS_TO
                        args:
                          - "kogito_process_instance_duration_seconds_sum"
                    group:
                      - columnGroup:
                          source: labels
                        groupFunctions:
                          - source: labels
                          - source: value</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/integrations/dashbuilder-workflows-metrics-dashboard.png" alt="dashbuilder workflows metrics dashboard">
</div>
<div class="title">Figure 2. Workflow Metrics Dashboard</div>
</div>
<div class="paragraph">
<p>If you are using Prometheus, we can use PROMQL with Prometheus REST API and transform the result to the JSON format supported by Dashbuilder to build dashboards. For further information about Dashbuilder and Prometheus check the article <a href="https://blog.kie.org/2022/07/creating-prometheus-dashboards-using-dashbuilder.html">Creating Prometheus Dashboards with Dashbuilder</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_data_index"><a class="anchor" href="#_using_data_index"></a>Using Data Index</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Data index is a service available during development mode, containing all data about the execution of workflow steps. By default, the data index is available at <code><a href="http://localhost:8180" class="bare">http://localhost:8180</a></code>, and it uses GraphQL, so Dashbuilder can connect to it using its REST API and transform the result to the supported format.</p>
</div>
<div class="olist arabic">
<div class="title">The steps to create a dashboard with data from Data Index:</div>
<ol class="arabic">
<li>
<p>Go to the Data Index GraphQL interface (default is <code><a href="http://localhost:8180/graphiql" class="bare">http://localhost:8180/graphiql</a></code>) and test your query. Let&#8217;s use as an example this query that lists all workflows:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Example GraphQL query to retrieve all workflows</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  ProcessInstances {
    processId
    processName
    state
    start
    end
    businessKey
    error {message}
  }
}</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Notice that when you run the query it modifies the URL to include the query. Copy the URL, but modify <code>graphiql</code> to <code>graphql</code>. When accessing it you will notice that it returns the result in a JSON format, such as:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">GraphQL JSON result when using the query above</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "data": {
    "ProcessInstances": [
      {
        "processId": "yamlgreet",
        "processName": "Greeting workflow",
        "state": "COMPLETED",
        "start": "2022-07-01T16:08:12.038Z",
        "end": "2022-07-01T16:08:12.061Z",
        "businessKey": null,
        "error": null
      },
    ]
  }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Internally, Workflows are referenced as process hence the fields <code>processId</code> and <code>processName</code> are actually the workflow id and name.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p>Now it is required to transform the response, so a transform expression is used. Notice also that it includes the columns metadata for the dataset</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Transform expression to get the fields from the JSON response</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "columns" :[
        {"id": "Workflow Id", "type": "label"},
        {"id": "Workflow Name", "type": "label"},
        {"id": "State", "type": "label"},
        {"id": "Start", "type": "label"},
        {"id": "End", "type": "label"},
        {"id": "Business Key", "type": "label"},
        {"id": "Error", "type": "label"}
    ],
    "values" : $.data.ProcessInstances.[ processId, processName, state, start, end, businessKey ? businessKey : "", error ? error.message : ""]
}</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Finally we can create our dashboard using the expression and the URL mentioned previously. Our dashboard has a bar chart that counts the process instances by State and list all dashboards in a table:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">Example Dashboard for Kogito Data Index</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">datasets:
    - uuid: workflows
      url: http://localhost:8180/graphql/?query=%7BProcessInstances%7BprocessId%20processName%20state%20start%20end%20businessKey%20error%7Bmessage%7D%7D%7D%0A
      expression: &gt;-
            {
                "columns" :[
                    {"id": "Workflow Id", "type": "label"},
                    {"id": "Workflow Name", "type": "label"},
                    {"id": "State", "type": "label"},
                    {"id": "Start", "type": "label"},
                    {"id": "End", "type": "label"},
                    {"id": "Business Key", "type": "label"},
                    {"id": "Error", "type": "label"}
                ],
                "values" : $.data.ProcessInstances.[ processId, processName, state, start, end, businessKey ? businessKey : "", error ? error.message : ""]
            }
pages:
    - components:
        - settings:
            type: BARCHART
            lookup:
                uuid: workflows
                group:
                    - columnGroup:
                        source: State
                      functions:
                          - source: State
                          - source: State
                            function: COUNT
        - settings:
            lookup:
                uuid: workflows</code></pre>
</div>
</div>
<div class="paragraph">
<p>The YML above results in the following dashboard:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/integrations/data-index-workflow-list-report.png" alt="data index workflow list report">
</div>
<div class="title">Figure 3. Dashboard with data from Data Index</div>
</div>
<div class="paragraph">
<p>For more examples check <a href="https://www.dashbuilder.org">Dashbuilder Website</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_found_an_issue"><a class="anchor" href="#_found_an_issue"></a><em><strong>Found an issue?</strong></em></h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you find an issue or any misleading information, please feel free to report it <a href="https://github.com/kiegroup/kogito-docs/issues/new">here</a>.
We really appreciate it!</p>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
<script src="../../../_/js/tabsBehavior.js"></script>
<script src="../../../_/js/vendor/lunr.js"></script>
<script src="../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../.." data-snippet-length="100" data-stylesheet="../../../_/css/search.css"></script>
<script async src="../../../search-index.js"></script>
  </body>
</html>
